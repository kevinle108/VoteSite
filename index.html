<!-- TABLE -->

<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="user-scalable=1" />
    <link rel='stylesheet' href='ballot.css' />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
    <script type="text/javascript" src="qrcode.min.js"></script>
    <script src='ballot.js'></script>
    <!-- <script src='ballot_260111_d.js'></script> -->
    <script src='WATERVILLE.js'></script>
    <!-- <script src='data.js'></script> -->
    <script src='ballotpdf.js'></script>
    <script src='buildSelectionPage.js'></script>
    <script src='ovalSelection.js'></script>
    <script src='buildReviewPage.js'></script>
    <script src='keyboard.js'></script>
    <script src='affidavitPage.js'></script>

    <title>Bradley Democratic Primary</title>
</head>

<body>
    <div id="selection">
        <section style="background-color: #e6e9ed; padding: 10px;">
            <h1>State of Maine Office Ballot</h1>
            <h1>Democratic Primary Election, July 14, 2020</h1>
            <h3>for</h3>
            <h3>Bradley</h3>
        </section>

        <main id="contests">
        </main>
        <button id="reviewButton" type="submit">Review</button>
        <!-- <hr style="height: 5px; background-color: black;" /> -->
        <!-- <div class='btn-wrapper'>
            <button class='btn-inline' onclick="doneAndCreatePdf()">Create PDF</button>
            <button class='btn-inline' onclick="doneAndCreateQRCode()">Create QR
                Code</button>
        </div> -->
    </div>

    <div id='qrpage' style="display: none;">
        <div class='btn-wrapper'>
            <button class="btn-inline" onclick="backToSelection()">&larr;&ensp;Back</button>
        </div>
        <h3>Please bring this QR code to the polling site to print your ballot</h3>
        <div id="qrcode" style="width:200px; height:200px; margin:40px auto;"></div>
    </div>

    <div id="reviewPage">
        <h1>Review</h1>
        <p id="reviewPageInstructions">Listed below is a summary of your selections for each contest. If you need to change your selection, each contest is a link that will scroll you back to that part of the ballot where you change your selections. When you are done reviewing all selections, please read and sign the Affirmation form below with your password.</p>
        <div id="reviewBody"></div>
        <div id="reviewFooter" class="buttonDiv">
            <button id="backToSelectionButton" onclick="backToSelection()">Back to Selection Page</button>
            <button id="gotToAffirmationButton"onclick="goToAffirmation()">Go to Affirmation Page</button>
            <!-- <button onclick="createBallotPdf(ballot)">Create PDF</button>  -->
        </div>
    </div>

    <div id="affidavitPage">
        <h1>Maine Accessible Absentee Ballot Affirmation</h1>
        <p>Warning: Knowingly providing falsified information on this affidavit is illegal under State and federal
     law and could result in criminal sanctions.</p>
        <br>
        <div class="affidavitTopBox">
          <p>I am a U.S. citizen residing inside the United States who is blind or otherwise disabled.</p>
        </div>
        <br>
        <div class="affidavitTopBox">
          <p>My name and Maine voting residence (city or town):</p>
          <p>Voter’s name: Mary Smith</p>
          <p>City or Town: Lewiston</p>
        </div>
        <br>
        <p>Affirmation – I swear or affirm, under penalty of perjury, that:</p>
        <ol>
          <li><p>I am blind or otherwise disabled, and my disability prevents or substantially limits me from being able to privately and independently complete a paper absentee ballot. I require use of an accessible electronic absentee ballot in order to vote privately and independently without visiting a clerk’s office or voting place and using a ballot marking device; and</p></li>
          <li><p> I am a U.S. citizen, at least 18 years of age (or will be by the day of the election), eligible to vote in the requested jurisdiction; and</p></li>
          <li><p> I am not registering, requesting a ballot, or voting in any other jurisdiction in the U.S.; and</p></li>
          <li><p> I am completing and returning only one authorized absentee ballot; and</p></li>
          <li><p>I have not made additional copies of the absentee ballot or provided them to other voters; and</p></li>
          <li><p>My signature and date below indicate when I completed this document; and</p></li>
          <li><p>The information on this form is true and complete to the best of my knowledge. I understand that a material misstatement of fact in completion of this document may constitute grounds for conviction of perjury; and</p></li>
          <li><p> I understand that, with any absentee ballot, my name and signature will be permanently separated from my voted ballot to maintain its secrecy at the outset of the tabulation process and thereafter.</p></li>
        </ol>
    
        <div class="affidavitBottomBox">
          <p> If you are marking the ballot on your computer with Adobe Reader, please enter your password in the 'Signed by' field below, click the 'Done' button, save the document to your computer, then email it as an attachment to <strong>UOCAVA.CEC@maine.gov</strong>.                                 
          </p>
          <p>Note: password for testing is "<strong>vote!</strong>"</p>
        </div>
        <br>
          <label for="signedby">Signed by:</label>
          <input type="password" id="signedby" name="signedby"><br><br>
          <label for="date">Date:</label>
          <input type="text" id="date" name="date"><br><br>
          <div class="buttonDiv">
            <button onclick="backToReview()">Back to Review Page</button>
            <button onclick="submit()">Done</button>  
          </div>
                
    </div>
    <div id="overlay"></div>
    <div id="modal" role="alertdialog" aria-labelledby="modalTitle" aria-describedby="modalText">
        <h2 id="modalTitle">Confirm Selection</h2>
        <p id="modalText">Modal text here</p>
        <div class="modalButtonDiv">
            <button class="button" onclick="return false;" id="yesButton">Yes</a>
            <button class="button" onclick="return false;" id="noButton">No</a>
        </div>
    </div>

    <script type="text/javascript">
        var qrcode = new QRCode(document.getElementById("qrcode"), {
            width: 200,
            height: 200
        });

        function doneAndCreateQRCode() {
            qrcode.makeCode(encodeVotes())
            document.getElementById('selection').style.display = 'none';
            document.getElementById('qrpage').style.display = 'block';
        }

        function encodeVotes() {
            let votes = ''
            let writeIns = ''
            syncSelectedVotesToBallotData()
            ballot.contests.forEach((contest, contestIndex) => {
                contest.candidates.forEach((candidate, candidateIndex) => {
                    votes += candidate.selected.toString()
                    if (candidate.selected && candidate.candidateCode.includes('writein')) {
                        writeIns += '|' + candidate.candidateName
                    }
                })
            })
            return votes + writeIns;
        }

        function backToSelection() {
            document.getElementById('selection').scrollIntoView()
            document.getElementById('selection').focus()
            document.getElementById('selection').classList.toggle('sr-only') // show
            document.getElementById('reviewPage').classList.toggle('sr-only') // hide
        }

        function backToReview() {
            document.getElementById('reviewPage').scrollIntoView()
            document.getElementById('reviewPage').focus()
                        
            document.getElementById('reviewPage').classList.toggle('sr-only') // show
            document.getElementById('affidavitPage').classList.toggle('sr-only') // hide
        }



        function goToAffirmation() {
            document.getElementById('affidavitPage').scrollIntoView()
            document.getElementById('affidavitPage').focus()

            document.getElementById('affidavitPage').classList.toggle('sr-only') // show
            document.getElementById('reviewPage').classList.toggle('sr-only') // hide
        }
    </script>

</body>